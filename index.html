<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Dashboard Gastos AO VIVO</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
        .container{max-width:1200px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden}
        .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:40px;text-align:center}
        .header h1{font-size:2.5em;margin:0}
        .controls{padding:25px;text-align:center;background:#f8f9fa}
        button{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;padding:15px 30px;border-radius:50px;font-size:16px;cursor:pointer;margin:0 10px;box-shadow:0 5px 20px rgba(102,126,234,0.4);transition:all 0.3s}
        button:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(102,126,234,0.6)}
        .content{display:grid;grid-template-columns:1fr 320px;gap:40px;padding:50px}
        #chartContainer{height:500px;position:relative}
        .status{font-weight:bold;padding:15px;background:#d4edda;color:#155724;border-radius:10px;margin:10px 0;display:none}
        #resumoList div{display:flex;justify-content:space-between;padding:15px;margin:10px 0;background:#f8f9fa;border-radius:12px;transition:0.3s}
        #resumoList div:hover{background:#e3f2fd;transform:translateX(5px)}
        .total{font-size:2.5em;color:#667eea;text-align:center;margin:30px 0;font-weight:bold;background:linear-gradient(135deg,#667eea,#764ba2);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        @media(max-width:768px){.content{grid-template-columns:1fr;padding:20px}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Dashboard Gastos</h1>
            <p><strong>Villyam + Esposa</strong> ‚Ä¢ AO VIVO com Google Sheets</p>
        </div>
        
        <div class="controls">
            <button onclick="loadData()">üîÑ ATUALIZAR AO VIVO</button>
            <div id="status" class="status"></div>
        </div>
        
        <div class="content">
            <div id="chartContainer">
                <canvas id="gastoChart"></canvas>
            </div>
            <div>
                <h3 style="color:#667eea;margin-bottom:20px">üìä Resumo por Categoria</h3>
                <div id="resumoList"></div>
                <div class="total" id="totalGeral">R$ 0,00</div>
            </div>
        </div>
    </div>

    <script>
        let chart;
        <script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSkcXwtIb0eb1ITcVfOYQEpginAMOgWwP9bxKlK5QX5A3Xsj_aAYtAs4mpMItN5sqmEqfSB0svt1n4K/pub?output=csv';

async function loadData()

        async function loadData() {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.innerHTML = 'üîÑ Sincronizando com Google Sheets...';
            
            try {
                const response = await fetch(CSV_URL);
                const csv = await response.text();
                
                const lines = csv.split('\n').slice(1, 12); // Primeiras 11 linhas (cabe√ßalho + 10 categorias)
                const labels = [], values = [];
                
                lines.forEach(line => {
                    if(line.trim()) {
                        const parts = line.split(',');
                        const cat = parts[0]?.trim();
                        const val = parseFloat(parts[1]?.replace(/[R$\s%,]/g, '').replace(',', '.')) || 0;
                        if(cat && !isNaN(val)) {
                            labels.push(cat);
                            values.push(val);
                        }
                    }
                });
                
                if(labels.length === 0) throw new Error('Nenhum dado v√°lido encontrado');
                
                updateDashboard(labels, values);
                status.innerHTML = `‚úÖ ATUALIZADO! ${labels.length} categorias carregadas`;
                setTimeout(() => status.style.display = 'none', 3000);
                
            } catch(error) {
                status.innerHTML = `‚ùå Erro: ${error.message}<br>Verifique se aba "Resumo" tem dados`;
                status.style.background = '#f8d7da';
                status.style.color = '#721c24';
                console.error(error);
            }
        }
        
        function updateDashboard(labels, values) {
            const total = values.reduce((a, b) => a + b, 0);
            
            // Gr√°fico
            const ctx = document.getElementById('gastoChart').getContext('2d');
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                            '#DDA0DD', '#98D8C8', '#F7DC6F', '#FF9FF3', '#54A0FF'
                        ],
                        borderColor: '#fff',
                        borderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.85)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                label: ctx => {
                                    const value = ctx.parsed;
                                    const perc = ((value / total) * 100).toFixed(1);
                                    return `${ctx.label}: R$ ${value.toLocaleString('pt-BR')} (${perc}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Lista
            const list = document.getElementById('resumoList');
            list.innerHTML = '';
            labels.forEach((label, i) => {
                const perc = ((values[i] / total) * 100).toFixed(1);
                list.innerHTML += `
                    <div style="display:flex;justify-content:space-between;padding:15px;background:#f8f9fa;border-radius:12px;margin:8px 0">
                        <span style="font-weight:500">${label}</span>
                        <div style="text-align:right">
                            <strong>R$ ${values[i].toLocaleString('pt-BR')}</strong><br>
                            <small style="color:#666">${perc}%</small>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('totalGeral').textContent = `R$ ${total.toLocaleString('pt-BR')}`;
        }
        
        // Auto-carrega
        window.onload = () => setTimeout(loadData, 1000);
    </script>
</body>
</html>

